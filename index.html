<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SKF - Calcolo Gioco Radiale</title>
  <link rel="icon" href="favicon.ico" type="image/x-icon">
  <link rel="apple-touch-icon" href="skf-192.png">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#005BBB"/>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container">
    <img src="skf-192.png" alt="SKF Logo" class="logo" />
    <h1>Calcolo Gioco Radiale <span class="ver">v3.7 (PWA)</span></h1>

    <div class="actions">
      <button id="btnInstall" class="ghost">➕ Installa app</button>
      <span class="install-hint" id="installHint">Usa “Aggiungi a schermata Home” o il pulsante sopra per installare.</span>
    </div>

    <div class="grid">
      <div class="card">
        <h2>Configurazione IR / OR</h2>
        <label>IR min: <input type="number" id="irMin" value="-10"></label>
        <label>IR max: <input type="number" id="irMax" value="10"></label>
        <label>OR min: <input type="number" id="orMin" value="0"></label>
        <label>OR max: <input type="number" id="orMax" value="30"></label>
        <label class="inline"><input type="checkbox" id="preferIR0" checked> preferisci IR vicino a 0</label>
        <p class="hint">Clicca una riga della tabella per impostare IR/OR min–max intorno a quei valori (±1 µm).</p>
      </div>

      <div class="card">
        <h2>Gioco Radiale & Offset</h2>
        <label>Offset (da -5 a +10): <input type="number" id="offset" value="0" min="-5" max="10" step="0.1"></label>
        <label>GR minimo (µm): <input type="number" id="grMin" value="35" step="0.1"></label>
        <label>GR massimo (µm): <input type="number" id="grMax" value="40" step="0.1"></label>
        <label>Sfere fisse: <code>−4, −2, 0, +2, +4</code></label>
      </div>
    </div>

    <div class="actions">
      <button id="btnCalcola">Calcola Combinazioni</button>
      <label class="inline"><input type="checkbox" id="onlyValid"> mostra solo valide</label>
      <button id="btnCSV" class="secondary">Esporta CSV</button>
    </div>

    <div class="grid">
      <div class="card">
        <h2>Cruscotto</h2>
        <div id="dashboard" class="dashboard">
          <div><strong>Valide:</strong> <span id="dashValid">0</span></div>
          <div><strong>GR target:</strong> <span id="dashTarget">–</span> µm</div>
          <div><strong>GR ottenibile:</strong> <span id="dashRange">–</span> µm</div>
          <div><strong>IR ideale</strong>: <span id="dashIR">–</span></div>
          <div><strong>OR ideale</strong>: <span id="dashOR">–</span></div>
          <div><strong>Sfere usate</strong>: <span id="dashSfere">–</span></div>
          <div><strong>Copertura sfere:</strong> <span id="dashCover">–</span></div>
        </div>
      </div>

      <div class="card table-card">
        <h2>Combinazioni</h2>
        <div class="table-wrap">
          <table id="tabellaRisultati">
            <thead>
              <tr><th>IR</th><th>OR</th><th>Sfera</th><th>Offset</th><th>GR</th><th>Valido?</th></tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </div>

    <div class="grid">
      <div class="card">
        <h2>Grafico distribuzione GR (tutte)</h2>
        <canvas id="chartAll" height="260" style="width:100%"></canvas>
      </div>
      <div class="card">
        <h2>Grafico distribuzione GR (valide)</h2>
        <canvas id="chartValid" height="260" style="width:100%"></canvas>
      </div>
    </div>
  </div>

  <script src="script.js"></script>
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js');
    }
    let deferredPrompt=null;
    window.addEventListener('beforeinstallprompt', e => {
      e.preventDefault();
      deferredPrompt = e;
      document.getElementById('btnInstall').style.display='inline-block';
    });
    document.getElementById('btnInstall').addEventListener('click', async () => {
      if(!deferredPrompt) return;
      deferredPrompt.prompt();
      await deferredPrompt.userChoice;
      deferredPrompt=null;
      document.getElementById('btnInstall').style.display='none';
    });
  </script>
</body>
</html>